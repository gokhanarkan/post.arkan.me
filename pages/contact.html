<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://unpkg.com/tailwindcss@^1.0/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/@tailwindcss/ui@latest/dist/tailwind-ui.min.css"
    />
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <title>Contact me | post.arkan.me</title>
    <style>
      .loader {
        border-top-color: #3498db;
        -webkit-animation: spinner 1.5s linear infinite;
        animation: spinner 1.5s linear infinite;
      }

      @-webkit-keyframes spinner {
        0% {
          -webkit-transform: rotate(0deg);
        }

        100% {
          -webkit-transform: rotate(360deg);
        }
      }

      @keyframes spinner {
        0% {
          transform: rotate(0deg);
        }

        100% {
          transform: rotate(360deg);
        }
      }
    </style>
  </head>

  <body>
    <div id="app">
      <div
        v-if="!loading"
        class="bg-white py-16 px-4 overflow-hidden sm:px-6 lg:px-8 lg:py-24"
      >
        <div class="relative max-w-xl mx-auto">
          <svg
            class="absolute left-full transform translate-x-1/2"
            width="404"
            height="404"
            fill="none"
            viewBox="0 0 404 404"
          >
            <defs>
              <pattern
                id="85737c0e-0916-41d7-917f-596dc7edfa27"
                x="0"
                y="0"
                width="20"
                height="20"
                patternUnits="userSpaceOnUse"
              >
                <rect
                  x="0"
                  y="0"
                  width="4"
                  height="4"
                  class="text-gray-200"
                  fill="currentColor"
                />
              </pattern>
            </defs>
            <rect
              width="404"
              height="404"
              fill="url(#85737c0e-0916-41d7-917f-596dc7edfa27)"
            />
          </svg>
          <svg
            class="absolute right-full bottom-0 transform -translate-x-1/2"
            width="404"
            height="404"
            fill="none"
            viewBox="0 0 404 404"
          >
            <defs>
              <pattern
                id="85737c0e-0916-41d7-917f-596dc7edfa27"
                x="0"
                y="0"
                width="20"
                height="20"
                patternUnits="userSpaceOnUse"
              >
                <rect
                  x="0"
                  y="0"
                  width="4"
                  height="4"
                  class="text-gray-200"
                  fill="currentColor"
                />
              </pattern>
            </defs>
            <rect
              width="404"
              height="404"
              fill="url(#85737c0e-0916-41d7-917f-596dc7edfa27)"
            />
          </svg>
          <div class="text-center">
            <h2
              class="text-3xl leading-9 font-extrabold tracking-tight text-gray-900 sm:text-4xl sm:leading-10"
            >
              Contact me
            </h2>
            <p class="mt-4 text-lg leading-6 text-gray-500">
              This is a little demo.<br />
              Built with
              <a
                href="https://vuejs.org/"
                target="_blank"
                rel="noreferrer noopener"
                class="text-green-500 underline"
              >
                Vue.js
              </a>
              as a single HTML page.<br />
              Get the source code
              <a
                href="https://github.com/gokhj/post.arkan.me/blob/master/pages/contact.html"
                target="_blank"
                rel="noreferrer noopener"
                class="text-blue-500 underline"
                >here</a
              >.
            </p>
          </div>

          <p class="text-center mt-4 text-lg leading-6 text-red-500">
            {{ error }}
          </p>

          <div class="mt-12">
            <form
              method="POST"
              class="grid grid-cols-1 gap-y-6 sm:grid-cols-2 sm:gap-x-8"
            >
              <div>
                <label
                  for="first_name"
                  class="block text-sm font-medium leading-5 text-gray-700"
                  >First name</label
                >
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    id="first_name"
                    class="form-input py-3 px-4 block w-full transition ease-in-out duration-150"
                    v-model="firstName"
                  />
                </div>
              </div>
              <div>
                <label
                  for="last_name"
                  class="block text-sm font-medium leading-5 text-gray-700"
                  >Last name</label
                >
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    id="last_name"
                    class="form-input py-3 px-4 block w-full transition ease-in-out duration-150"
                    v-model="lastName"
                  />
                </div>
              </div>
              <div class="sm:col-span-2">
                <label
                  for="email"
                  class="block text-sm font-medium leading-5 text-gray-700"
                  >Email*</label
                >
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    id="email"
                    type="email"
                    class="form-input py-3 px-4 block w-full transition ease-in-out duration-150"
                    v-model="email"
                  />
                </div>
              </div>
              <div class="sm:col-span-2">
                <label
                  for="phone_number"
                  class="block text-sm font-medium leading-5 text-gray-700"
                  >Phone Number</label
                >
                <div class="mt-1 relative rounded-md shadow-sm">
                  <input
                    id="phone_number"
                    class="form-input py-3 px-4 block w-full transition ease-in-out duration-150"
                    v-model="phone"
                  />
                </div>
              </div>
              <div class="sm:col-span-2">
                <label
                  for="message"
                  class="block text-sm font-medium leading-5 text-gray-700"
                  >Message*</label
                >
                <div class="mt-1 relative rounded-md shadow-sm">
                  <textarea
                    id="message"
                    rows="4"
                    class="form-textarea py-3 px-4 block w-full transition ease-in-out duration-150"
                    v-model="message"
                  ></textarea>
                </div>
              </div>
              <div class="sm:col-span-2">
                <span class="w-full inline-flex rounded-md shadow-sm">
                  <button
                    v-on:click="contact"
                    type="button"
                    class="w-full inline-flex items-center justify-center px-6 py-3 border border-transparent text-base leading-6 font-medium rounded-md text-white bg-blue-600 hover:bg-blue-500 focus:outline-none focus:border-indigo-700 focus:shadow-outline-indigo active:bg-indigo-700 transition ease-in-out duration-150"
                  >
                    Submit
                  </button>
                </span>
              </div>
            </form>
          </div>
        </div>
      </div>
      <div
        v-if="loading === 'loading'"
        class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-64 w-64 m-auto"
      ></div>
      <div v-if="loading === 'result'">
        <p class="mt-4 text-lg leading-6 text-gray-500 text-center">
          Email sent successfully.
        </p>
      </div>
      <div v-if="loading === 'error'">
        <p class="mt-4 text-lg leading-6 text-red-500 text-center">
          Error happened. <br />
          I know it's not perfect!
        </p>
      </div>
    </div>
    <script>
      const app = new Vue({
        el: "#app",
        data: {
          firstName: "",
          lastName: "",
          email: "",
          phone: "",
          message: "",
          error: "",
          loading: false,
        },
        methods: {
          async contact() {
            // Check whether email or message empty
            if (!this.email || !this.message) {
              this.error = "Required fields cannot be empty";
              return;
            }

            // Check if the email is valid
            const validEmail = this.isValid(this.email);
            if (!validEmail) {
              this.error = "Email is not valid.";
              return;
            }

            // Get the name from the form
            const name = this.lastName
              ? `${this.firstName} ${this.lastName}`
              : this.firstName;

            // Prepare data
            const data = {
              name,
              email: this.email,
              message: this.message,
              phone: this.phone,
            };

            // Send the data
            try {
              this.loading = "loading";

              let response = await fetch("/", {
                method: "POST",
                headers: {
                  "Content-Type": "application/json",
                },
                body: JSON.stringify(data),
              });

              response = await response.json();

              if (!response.success) {
                this.loading = "error";
                return;
              }
              this.loading = "result";
            } catch (err) {
              this.loading = "error";
              console.log(err);
            }
          },
          isValid(email) {
            const re = /^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
            return re.test(email);
          },
        },
      });
    </script>
  </body>
</html>
